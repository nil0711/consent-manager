<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Consent Receipt — <%= study.title %> (v<%= consent.version %>)</title>
  <style>
    :root{
      --ink:#0F172A;--muted:#475569;--line:#E2E8F0;--zebra:#F8FAFC;
      --primary:#2563EB;
    }
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--ink);margin:0;padding:24px;line-height:1.45}
    h1{font-size:20px;margin:0 0 2px 0}
    h2{font-size:16px;margin:16px 0 8px}
    .muted{color:var(--muted)}
    .card{border:1px solid var(--line);border-radius:12px;padding:16px}
    .row{display:flex;gap:24px;flex-wrap:wrap;margin:6px 0}
    .col{min-width:200px}
    table{width:100%;border-collapse:collapse;border:1px solid var(--line);border-radius:10px;overflow:hidden}
    th,td{padding:10px 12px;border-top:1px solid var(--line)}
    th{background:#F1F5F9;text-align:left}
    tr:nth-child(even) td{background:var(--zebra)}
    .small{font-size:12px}
    code{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace}
    .header{margin-bottom:10px}
    .badge{display:inline-block;padding:2px 8px;border:1px solid var(--line);border-radius:999px;font-size:12px;color:#334155;background:#F8FAFC}
  </style>
</head>
<body>
  <div class="header">
    <div class="muted small">Consent Manager</div>
    <h1>Consent Receipt — <%= study.title %></h1>
    <div class="small muted">Receipt v<%= consent.version %> • Generated: <%= new Date().toISOString() %></div>
  </div>

  <div class="card">
    <div class="row">
      <div class="col">
        <div class="muted small">Study</div>
        <div><strong>Slug:</strong> <%= study.slug %></div>
        <div><strong>Default retention:</strong> <%= (study.retentionDefaultDays ?? "—") %> days</div>
      </div>
      <div class="col">
        <div class="muted small">Contact</div>
        <div><a href="mailto:<%= study.contactEmail %>"><%= study.contactEmail %></a></div>
      </div>
    </div>

    <h2>Decisions</h2>
    <table>
      <thead><tr><th>Category</th><th>Allowed?</th></tr></thead>
      <tbody>
        <% consent.choices.forEach(ch => { 
             const cat = study.categories?.find?.(c => c.id === ch.categoryId);
        %>
          <tr>
            <td><%= cat?.name || ch.categoryId %></td>
            <td><%= ch.allowed ? "Allowed" : "Denied" %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>

    <h2>Receipt integrity</h2>
    <div class="small">
      Hash: <code><%= consent.receiptHash %></code>
    </div>
  </div>
</body>
</html>
